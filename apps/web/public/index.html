<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Canon - Universe Builder</title>
    <script
      type="module"
      src="https://unpkg.com/standards-ui@1.33.0/dist/standards-ui.js"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/standards-ui@1.33.0/dist/standards-ui.css" />
    <style>
      :root {
        --wiki-bg: #ffffff;
        --wiki-border: #a2a9b1;
        --wiki-text: #202122;
        --wiki-text-secondary: #54595d;
        --wiki-link: #0645ad;
        --wiki-link-hover: #0b0080;
        --wiki-sidebar-bg: #f6f6f6;
        --wiki-header-bg: #ffffff;
        --wiki-header-border: #a2a9b1;
        --wiki-content-width: 1200px;
        --wiki-sidebar-width: 240px;
        --wiki-margin: 16px;
      }

      body {
        margin: 0;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background-color: var(--wiki-bg);
        color: var(--wiki-text);
        line-height: 1.6;
      }

      /* Wikipedia-style header */
      .wiki-header {
        background-color: var(--wiki-header-bg);
        border-bottom: 1px solid var(--wiki-header-border);
        padding: 8px 0;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .wiki-header-content {
        max-width: var(--wiki-content-width);
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 var(--wiki-margin);
      }

      .wiki-logo {
        font-size: 24px;
        font-weight: bold;
        color: var(--wiki-text);
        text-decoration: none;
      }

      .wiki-nav {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .wiki-nav a {
        color: var(--wiki-link);
        text-decoration: none;
        font-size: 14px;
      }

      .wiki-nav a:hover {
        text-decoration: underline;
      }

      /* Main layout */
      .wiki-container {
        max-width: var(--wiki-content-width);
        margin: 0 auto;
        display: flex;
        gap: 20px;
        padding: 20px var(--wiki-margin);
      }

      /* Sidebar */
      .wiki-sidebar {
        width: var(--wiki-sidebar-width);
        background-color: var(--wiki-sidebar-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 12px;
        height: fit-content;
        position: sticky;
        top: 80px;
      }

      .wiki-sidebar h3 {
        margin: 0 0 8px 0;
        padding: 0;
        font-size: 14px;
        font-weight: bold;
        color: var(--wiki-text);
        border-bottom: 1px solid var(--wiki-border);
        padding-bottom: 4px;
      }

      .wiki-sidebar ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .wiki-sidebar li {
        margin: 4px 0;
      }

      .wiki-sidebar a {
        color: var(--wiki-link);
        text-decoration: none;
        font-size: 13px;
        display: block;
        padding: 2px 0;
      }

      .wiki-sidebar a:hover {
        text-decoration: underline;
      }

      .wiki-sidebar .active {
        font-weight: bold;
        color: var(--wiki-text);
      }

      /* Main content area */
      .wiki-content {
        flex: 1;
        min-width: 0;
      }

      /* Universe detail layout */
      .content-area {
        display: flex;
        flex-direction: column;
        gap: 32px;
      }

      .hero {
        background-color: var(--wiki-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 24px;
      }

      .hero h1 {
        margin: 0 0 12px 0;
        font-size: 32px;
        font-weight: normal;
      }

      .hero p {
        margin: 0 0 16px 0;
        color: var(--wiki-text-secondary);
        font-size: 16px;
      }

      .category-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 16px;
      }

      .category-card {
        background-color: var(--wiki-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 16px;
        cursor: pointer;
        transition:
          border-color 0.2s,
          box-shadow 0.2s;
      }

      .category-card:hover {
        border-color: var(--wiki-link);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      .category-card h3 {
        margin: 0 0 8px 0;
        font-size: 18px;
        font-weight: bold;
      }

      .category-card p {
        margin: 0;
        color: var(--wiki-text-secondary);
        font-size: 14px;
        line-height: 1.4;
      }

      .category-sections {
        display: flex;
        flex-direction: column;
        gap: 32px;
      }

      .category-section {
        background-color: var(--wiki-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 20px;
      }

      .category-section-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 16px;
      }

      .category-section-header h2 {
        margin: 0 0 4px 0;
        font-size: 22px;
      }

      .category-section-header p {
        margin: 0;
        color: var(--wiki-text-secondary);
        font-size: 14px;
      }

      .category-section-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 16px;
      }

      .content-item {
        background-color: var(--wiki-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 16px;
        cursor: pointer;
        transition:
          border-color 0.2s,
          box-shadow 0.2s;
      }

      .content-item:hover {
        border-color: var(--wiki-link);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      .content-item h3 {
        margin: 0 0 8px 0;
        font-size: 16px;
        font-weight: bold;
        color: var(--wiki-text);
      }

      .content-item p {
        margin: 0;
        font-size: 14px;
        color: var(--wiki-text-secondary);
        line-height: 1.5;
      }

      .category-section-footer {
        display: flex;
        justify-content: flex-end;
        margin-top: 20px;
      }

      .empty-category,
      .empty-universe {
        margin: 0;
        color: var(--wiki-text-secondary);
        font-size: 14px;
      }

      /* Article styling */
      .wiki-article {
        background-color: var(--wiki-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 24px;
      }

      .wiki-article h1 {
        margin: 0 0 16px 0;
        padding: 0;
        font-size: 28px;
        font-weight: normal;
        color: var(--wiki-text);
        border-bottom: 1px solid var(--wiki-border);
        padding-bottom: 8px;
      }

      .wiki-article h2 {
        margin: 24px 0 16px 0;
        padding: 0;
        font-size: 22px;
        font-weight: bold;
        color: var(--wiki-text);
        border-bottom: 1px solid var(--wiki-border);
        padding-bottom: 4px;
      }

      .wiki-article h3 {
        margin: 20px 0 12px 0;
        padding: 0;
        font-size: 18px;
        font-weight: bold;
        color: var(--wiki-text);
      }

      .wiki-article p {
        margin: 0 0 16px 0;
        padding: 0;
        line-height: 1.6;
      }

      .wiki-article ul,
      .wiki-article ol {
        margin: 0 0 16px 0;
        padding-left: 32px;
      }

      .wiki-article li {
        margin: 4px 0;
      }

      .wiki-article a {
        color: var(--wiki-link);
        text-decoration: none;
      }

      .wiki-article a:hover {
        text-decoration: underline;
      }

      /* Homepage styling */
      .wiki-homepage {
        text-align: center;
        padding: 60px 24px;
      }

      .wiki-homepage h1 {
        font-size: 36px;
        font-weight: normal;
        margin: 0 0 16px 0;
        color: var(--wiki-text);
      }

      .wiki-homepage .subtitle {
        font-size: 18px;
        color: var(--wiki-text-secondary);
        margin: 0 0 40px 0;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      /* Card grid for homepage */
      .wiki-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin: 40px 0;
      }

      .wiki-card {
        background-color: var(--wiki-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 20px;
        text-align: left;
        transition: box-shadow 0.2s;
      }

      .wiki-card:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .wiki-card h3 {
        margin: 0 0 12px 0;
        font-size: 18px;
        font-weight: bold;
        color: var(--wiki-text);
      }

      .wiki-card p {
        margin: 0;
        color: var(--wiki-text-secondary);
        font-size: 14px;
        line-height: 1.5;
      }

      /* Button styling */
      .wiki-btn {
        background-color: var(--wiki-link);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 14px;
        text-decoration: none;
        display: inline-block;
        transition: background-color 0.2s;
      }

      .wiki-btn:hover {
        background-color: var(--wiki-link-hover);
        text-decoration: none;
      }

      .wiki-btn-secondary {
        background-color: transparent;
        color: var(--wiki-link);
        border: 1px solid var(--wiki-link);
      }

      .wiki-btn-secondary:hover {
        background-color: var(--wiki-link);
        color: white;
      }

      .creation-result .creation-actions {
        margin-top: 16px;
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      /* Loading and error states */
      .wiki-loading {
        text-align: center;
        padding: 40px;
        color: var(--wiki-text-secondary);
      }

      .wiki-error {
        background-color: #ffe6e6;
        border: 1px solid #ff6b6b;
        border-radius: 3px;
        padding: 16px;
        margin: 16px 0;
        color: #d63031;
      }

      /* Content list styling */
      .wiki-content-list {
        margin: 24px 0;
      }

      .wiki-content-item {
        background-color: var(--wiki-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 16px;
        margin-bottom: 12px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .wiki-content-item:hover {
        border-color: var(--wiki-link);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .wiki-content-item h3 {
        margin: 0 0 8px 0;
        font-size: 16px;
        font-weight: bold;
        color: var(--wiki-text);
      }

      .wiki-content-item p {
        margin: 0;
        font-size: 14px;
        color: var(--wiki-text-secondary);
      }

      /* Universe item styling */
      .universe-item {
        background-color: var(--wiki-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 16px;
        margin-bottom: 12px;
        cursor: pointer;
        transition: all 0.2s;
        list-style: none;
        display: block;
      }

      .universe-item:hover {
        border-color: var(--wiki-link);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        background-color: #f8f9fa;
      }

      .universe-item strong {
        color: var(--wiki-text);
        font-size: 16px;
        font-weight: bold;
        display: block;
        margin-bottom: 4px;
      }

      .universe-item small {
        color: var(--wiki-text-secondary);
        font-size: 14px;
        line-height: 1.4;
      }

      .universe-item.active {
        border-color: var(--wiki-link);
        background-color: #e3f2fd;
      }

      /* Modal styling */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-overlay.show {
        display: flex;
      }

      .modal {
        background-color: var(--wiki-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 24px;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .modal h2 {
        margin: 0 0 16px 0;
        font-size: 24px;
        font-weight: bold;
        color: var(--wiki-text);
      }

      .modal-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .form-group label {
        font-size: 14px;
        font-weight: bold;
        color: var(--wiki-text);
      }

      .form-group input {
        padding: 8px 12px;
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        font-size: 14px;
        background-color: var(--wiki-bg);
        color: var(--wiki-text);
      }

      .form-group input:focus {
        outline: none;
        border-color: var(--wiki-link);
        box-shadow: 0 0 0 2px rgba(6, 69, 173, 0.2);
      }

      .modal-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 8px;
      }

      .modal-actions .wiki-btn {
        min-width: 80px;
      }

      /* Queue page styling */
      .queue-stats {
        margin: 24px 0;
      }

      .queue-summary {
        background-color: var(--wiki-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 20px;
        margin-bottom: 24px;
      }

      .queue-summary h2 {
        margin: 0 0 16px 0;
        font-size: 22px;
        font-weight: bold;
        color: var(--wiki-text);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 16px;
      }

      .stat-card {
        background-color: var(--wiki-sidebar-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 16px;
        text-align: center;
        transition: all 0.2s;
      }

      .stat-card:hover {
        border-color: var(--wiki-link);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .stat-card.waiting {
        border-left: 4px solid #ffc107;
      }

      .stat-card.active {
        border-left: 4px solid #007bff;
      }

      .stat-card.completed {
        border-left: 4px solid #28a745;
      }

      .stat-card.failed {
        border-left: 4px solid #dc3545;
      }

      .stat-number {
        font-size: 24px;
        font-weight: bold;
        color: var(--wiki-text);
        margin-bottom: 4px;
      }

      .stat-label {
        font-size: 14px;
        color: var(--wiki-text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .queue-jobs {
        margin: 24px 0;
      }

      .queue-controls {
        display: flex;
        gap: 12px;
        margin-top: 24px;
        padding-top: 16px;
        border-top: 1px solid var(--wiki-border);
      }

      .queue-controls .wiki-btn {
        min-width: 120px;
      }

      /* Help page styling */
      .help-navigation {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 24px 0;
      }

      .nav-item {
        background-color: var(--wiki-sidebar-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 16px;
        transition: all 0.2s;
      }

      .nav-item:hover {
        border-color: var(--wiki-link);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .nav-item h3 {
        margin: 0 0 8px 0;
        font-size: 16px;
        font-weight: bold;
        color: var(--wiki-text);
      }

      .nav-item p {
        margin: 0;
        font-size: 14px;
        color: var(--wiki-text-secondary);
        line-height: 1.4;
      }

      .tech-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
        margin: 24px 0;
      }

      .tech-section {
        background-color: var(--wiki-sidebar-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 20px;
      }

      .tech-section h3 {
        margin: 0 0 12px 0;
        font-size: 18px;
        font-weight: bold;
        color: var(--wiki-text);
      }

      .tech-section p {
        margin: 0 0 12px 0;
        color: var(--wiki-text-secondary);
      }

      .api-links {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin: 24px 0;
      }

      .api-link-card {
        background-color: var(--wiki-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 20px;
        text-align: center;
        transition: all 0.2s;
      }

      .api-link-card:hover {
        border-color: var(--wiki-link);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      .api-link-card h3 {
        margin: 0 0 12px 0;
        font-size: 18px;
        font-weight: bold;
        color: var(--wiki-text);
      }

      .api-link-card p {
        margin: 0 0 16px 0;
        color: var(--wiki-text-secondary);
        font-size: 14px;
      }

      .getting-started {
        margin: 24px 0;
      }

      .step {
        display: flex;
        gap: 16px;
        margin-bottom: 24px;
        padding: 16px;
        background-color: var(--wiki-sidebar-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
      }

      .step-number {
        background-color: var(--wiki-link);
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 16px;
        flex-shrink: 0;
      }

      .step-content h3 {
        margin: 0 0 8px 0;
        font-size: 18px;
        font-weight: bold;
        color: var(--wiki-text);
      }

      .step-content p {
        margin: 0;
        color: var(--wiki-text-secondary);
        line-height: 1.5;
      }

      .troubleshooting {
        margin: 24px 0;
      }

      .trouble-item {
        background-color: var(--wiki-sidebar-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 16px;
        margin-bottom: 16px;
      }

      .trouble-item h3 {
        margin: 0 0 8px 0;
        font-size: 16px;
        font-weight: bold;
        color: var(--wiki-text);
      }

      .trouble-item p {
        margin: 0;
        color: var(--wiki-text-secondary);
        font-size: 14px;
        line-height: 1.4;
      }

      .useful-links {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin: 24px 0;
      }

      .link-card {
        background-color: var(--wiki-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 20px;
        text-decoration: none;
        color: inherit;
        transition: all 0.2s;
        display: block;
      }

      .link-card:hover {
        border-color: var(--wiki-link);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        text-decoration: none;
      }

      .link-card h3 {
        margin: 0 0 12px 0;
        font-size: 18px;
        font-weight: bold;
        color: var(--wiki-text);
      }

      .link-card p {
        margin: 0;
        color: var(--wiki-text-secondary);
        font-size: 14px;
        line-height: 1.4;
      }

      .help-footer {
        background-color: var(--wiki-sidebar-bg);
        border: 1px solid var(--wiki-border);
        border-radius: 3px;
        padding: 20px;
        margin-top: 32px;
        text-align: center;
      }

      .help-footer p {
        margin: 0;
        color: var(--wiki-text-secondary);
        font-size: 14px;
      }

      /* Responsive design */
      @media (max-width: 1024px) {
        .wiki-container {
          flex-direction: column;
        }

        .wiki-sidebar {
          width: 100%;
          position: static;
          order: 2;
        }

        .wiki-content {
          order: 1;
        }
      }

      @media (max-width: 768px) {
        .wiki-header-content {
          flex-direction: column;
          gap: 12px;
          text-align: center;
        }

        .wiki-container {
          padding: 12px;
        }

        .wiki-article {
          padding: 16px;
        }

        .wiki-homepage {
          padding: 40px 16px;
        }

        .wiki-cards {
          grid-template-columns: 1fr;
        }

        .category-grid {
          grid-template-columns: 1fr;
        }

        .category-section-header {
          flex-direction: column;
          align-items: flex-start;
        }

        .category-section-content {
          grid-template-columns: 1fr;
        }

        .category-section-footer {
          justify-content: flex-start;
        }

        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .queue-controls {
          flex-direction: column;
          align-items: stretch;
        }

        .queue-controls .wiki-btn {
          width: 100%;
        }

        .help-navigation {
          grid-template-columns: 1fr;
        }

        .tech-info {
          grid-template-columns: 1fr;
        }

        .api-links {
          grid-template-columns: 1fr;
        }

        .useful-links {
          grid-template-columns: 1fr;
        }

        .step {
          flex-direction: column;
          text-align: center;
        }

        .step-number {
          align-self: center;
        }
      }
    </style>
  </head>
  <body>
    <!-- Wikipedia-style header -->
    <header class="wiki-header">
      <div class="wiki-header-content">
        <a href="/" class="wiki-logo" onclick="showHomepage(); return false;">
          Canon
        </a>
        <nav class="wiki-nav">
          <a href="/" onclick="showHomepage(); return false;">Home</a>
          <a href="#create" onclick="createNewUniverse(); return false;"
            >Create</a
          >
          <a href="#queue" onclick="showQueue(); return false;">Queue</a>
          <a href="#help" onclick="showHelp(); return false;">Help</a>
        </nav>
      </div>
    </header>

    <!-- Main container -->
    <div class="wiki-container">
      <!-- Sidebar -->
      <aside class="wiki-sidebar" id="wiki-sidebar">
        <h3>Navigation</h3>
        <ul id="sidebar-content">
          <li>
            <a href="/" onclick="showHomepage(); return false;">Main Page</a>
          </li>
          <li>
            <a href="/universes" onclick="showUniverseList(); return false;">
              All Universes
            </a>
          </li>
        </ul>
      </aside>

      <!-- Main content -->
      <main class="wiki-content">
        <div id="main-content">
          <!-- Homepage -->
          <section id="homepage" class="wiki-homepage">
            <h1>Canon</h1>
            <p class="subtitle">
              An LLM-driven universe builder that creates rich, interconnected
              fictional worlds with geography, flora, fauna, intelligent
              species, cultures, and technologies.
            </p>

            <a
              href="#"
              class="wiki-btn"
              onclick="createNewUniverse(); return false;">
              Create Your First Universe
            </a>

            <div class="wiki-cards">
              <div class="wiki-card">
                <h3>🌍 Worlds</h3>
                <p>
                  Explore planets, space stations, and other locations with
                  detailed geography, climate, and resources.
                </p>
              </div>
              <div class="wiki-card">
                <h3>👥 Characters</h3>
                <p>
                  Meet intelligent beings from various species with unique
                  backgrounds, personalities, and relationships.
                </p>
              </div>
              <div class="wiki-card">
                <h3>🏛️ Cultures</h3>
                <p>
                  Discover societies with their own values, government
                  structures, and cultural artifacts.
                </p>
              </div>
              <div class="wiki-card">
                <h3>⚡ Technologies</h3>
                <p>
                  Learn about advanced technologies, from FTL drives to alien
                  innovations beyond our understanding.
                </p>
              </div>
            </div>
          </section>

          <!-- Universe Content (hidden by default) -->
          <section
            id="universe-content"
            class="wiki-article"
            style="display: none">
            <!-- Content will be loaded dynamically via JavaScript -->
          </section>

          <!-- Loading Indicator -->
          <div
            id="loading-indicator"
            class="wiki-loading"
            style="display: none">
            <p>Creating universe...</p>
          </div>
        </div>
      </main>
    </div>

    <!-- Universe Creation Modal -->
    <div id="universe-modal" class="modal-overlay">
      <div class="modal">
        <h2>Create New Universe</h2>
        <form id="universe-form" class="modal-form">
          <div class="form-group">
            <label for="universe-name">Universe Name</label>
            <input
              type="text"
              id="universe-name"
              name="name"
              placeholder="Enter universe name"
              required />
          </div>
          <div class="modal-actions">
            <button
              type="button"
              class="wiki-btn wiki-btn-secondary"
              onclick="hideUniverseModal()">
              Cancel
            </button>
            <button type="submit" class="wiki-btn">Create Universe</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Initialize standards-ui with ES6 modules
      document.addEventListener("DOMContentLoaded", async function () {
        console.log("DOM loaded, checking for StandardsUI...");

        try {
          // Try to import StandardsUI as ES6 module
          const { StandardsUI } = await import(
            "https://unpkg.com/standards-ui@1.33.0/dist/standards-ui.js"
          );
          console.log("StandardsUI imported successfully:", StandardsUI);

          if (StandardsUI && typeof StandardsUI.init === "function") {
            console.log("Initializing StandardsUI...");
            const tokens = StandardsUI.DEFAULT_TOKENS;
            console.log("Using tokens:", tokens);
            StandardsUI.init(tokens);
            console.log("StandardsUI initialized successfully!");
          } else {
            console.log("StandardsUI.init not available");
          }
        } catch (error) {
          console.error("Error importing StandardsUI:", error);

          // Fallback: check window object
          console.log("Checking window.StandardsUI:", window.StandardsUI);
          if (typeof window.StandardsUI !== "undefined") {
            console.log("Using window.StandardsUI fallback...");
            const tokens = window.StandardsUI.DEFAULT_TOKENS;
            window.StandardsUI.init(tokens);
            console.log("StandardsUI initialized via window object!");
          }
        }
      });

      // URL Routing Functions
      function updateURL(path, state, options = {}) {
        const { replace = false } = options;
        if (!history.pushState) {
          return;
        }

        if (replace) {
          history.replaceState(state, "", path);
        } else {
          history.pushState(state, "", path);
        }
      }

      function parseURL() {
        const path = window.location.pathname;
        const segments = path.split("/").filter((segment) => segment);

        if (segments.length === 0) {
          return { view: "home" };
        }

        if (segments[0] === "universes") {
          return { view: "universe-list" };
        }

        if (segments[0] === "queue") {
          return { view: "queue" };
        }

        if (segments[0] === "universe" && segments[1]) {
          if (segments[2] === "category" && segments[3]) {
            return {
              view: "category",
              universeId: segments[1],
              categoryName: decodeURIComponent(segments[3]),
            };
          }

          return {
            view: "universe",
            universeId: segments[1],
          };
        }

        if (segments[0] === "page" && segments[1]) {
          return {
            view: "page",
            pageId: segments[1],
          };
        }

        return { view: "home" };
      }

      function handleRoute(route, options = {}) {
        const { skipHistory = false, replace = false } = options;
        const historyOptions = { skipHistory, replace };

        switch (route?.view) {
          case "home":
            showHomepage(historyOptions);
            break;
          case "universe-list":
            showUniverseList(historyOptions);
            break;
          case "queue":
            showQueue(historyOptions);
            break;
          case "universe":
            showUniverse(route.universeId, historyOptions);
            break;
          case "category":
            showUniverse(route.universeId, historyOptions);
            loadCategory(route.universeId, route.categoryName, historyOptions);
            break;
          case "page":
            loadPage(route.pageId, historyOptions);
            break;
          default:
            showHomepage(historyOptions);
            break;
        }
      }

      // Load universes on page load
      document.addEventListener("DOMContentLoaded", function () {
        // Handle initial URL and seed history state
        const initialRoute = window.history.state || parseURL();
        handleRoute(initialRoute, { replace: true });

        // Add form submission handler
        const universeForm = document.getElementById("universe-form");
        if (universeForm) {
          universeForm.addEventListener("submit", function (event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const universeName = formData.get("name");

            createNewUniverse(
              typeof universeName === "string" ? universeName : ""
            );
          });
        }

        // Add click outside modal to close functionality
        const modal = document.getElementById("universe-modal");
        if (modal) {
          modal.addEventListener("click", function (event) {
            if (event.target === modal) {
              hideUniverseModal();
            }
          });
        }

        // Add escape key to close modal
        document.addEventListener("keydown", function (event) {
          if (event.key === "Escape") {
            const modal = document.getElementById("universe-modal");
            if (modal && modal.classList.contains("show")) {
              hideUniverseModal();
            }
          }
        });
      });

      // Handle browser back/forward buttons
      window.addEventListener("popstate", function (event) {
        const route = event.state || parseURL();
        handleRoute(route, { skipHistory: true });
      });

      function loadUniverses() {
        fetch("http://localhost:3000/universes")
          .then((response) => response.text())
          .then((html) => {
            // Find the ds-col wrapper and update its content
            const dsCol = document.querySelector("#universe-list ds-col");
            if (dsCol) {
              dsCol.innerHTML = html;
            } else {
              // Fallback: wrap the content in ds-col
              document.getElementById("universe-list").innerHTML =
                `<ds-col gap="24px">${html}</ds-col>`;
            }

            // Event listeners are handled by document-level click handler
            console.log(
              "Universe items loaded, event handling via document listener"
            );
          })
          .catch((error) => {
            console.error("Error loading universes:", error);
            const dsCol = document.querySelector("#universe-list ds-col");
            if (dsCol) {
              dsCol.innerHTML =
                '<li class="error">Error loading universes</li>';
            } else {
              document.getElementById("universe-list").innerHTML =
                '<ds-col gap="24px"><li class="error">Error loading universes</li></ds-col>';
            }
          });
      }

      function showUniverse(universeId, options = {}) {
        const { skipHistory = false, replace = false } = options;
        console.log("showUniverse called with ID:", universeId);

        // Stop queue polling when navigating away
        stopQueuePolling();

        // Update URL
        if (!skipHistory) {
          updateURL(
            `/universe/${universeId}`,
            { view: "universe", universeId },
            { replace }
          );
        }

        // Clear main content and show loading
        const mainContent = document.getElementById("main-content");
        if (mainContent) {
          mainContent.innerHTML = `
            <section id="universe-content" class="wiki-article" style="display: block;" data-universe-id="${universeId}">
              <div class="wiki-loading">Loading universe content...</div>
            </section>
          `;
        } else {
          console.error("Main content element not found");
          return;
        }

        // Load universe content and update sidebar with categories
        console.log(
          "Fetching universe content from:",
          `http://localhost:3000/universes/${universeId}`
        );
        fetch(`http://localhost:3000/universes/${universeId}`)
          .then((response) => {
            console.log("Fetch response status:", response.status);
            return response.text();
          })
          .then((html) => {
            console.log("Universe content received, length:", html.length);

            // Get the universe content element (it might have been created above)
            const currentUniverseContent =
              document.getElementById("universe-content");
            if (currentUniverseContent) {
              currentUniverseContent.innerHTML = html;
              console.log("Universe content loaded successfully");
              // Load categories for sidebar
              loadUniverseCategories(universeId);
            } else {
              console.error(
                "Universe content element still not found after creation"
              );
            }
          })
          .catch((error) => {
            console.error("Error loading universe:", error);
            const currentUniverseContent =
              document.getElementById("universe-content");
            if (currentUniverseContent) {
              currentUniverseContent.innerHTML =
                '<div class="wiki-error">Error loading universe content: ' +
                error.message +
                "</div>";
            }
          });
      }

      function loadUniverseCategories(universeId) {
        console.log("loadUniverseCategories called with ID:", universeId);

        // Update sidebar to show categories instead of universes
        const sidebar = document.querySelector("#wiki-sidebar");
        if (!sidebar) {
          console.error("Sidebar element not found");
          return;
        }

        sidebar.innerHTML = `
          <ds-col gap="24px">
            <header>
              <h2>Navigation</h2>
            </header>
            <nav>
              <ul class="category-list" id="category-list">
                <ds-col gap="24px">
                  <li class="loading">Loading categories...</li>
                </ds-col>
              </ul>
            </nav>
          </ds-col>
        `;

        // Load categories from universe content
        fetch(`http://localhost:3000/universes/${universeId}`)
          .then((response) => response.text())
          .then((html) => {
            // Extract categories from the universe page
            const tempDiv = document.createElement("div");
            tempDiv.innerHTML = html;
            const categoryCards = tempDiv.querySelectorAll(".category-card");

            const categories = Array.from(categoryCards)
              .map((card) => {
                const onclick = card.getAttribute("onclick");
                const match = onclick.match(
                  /loadCategory\('([^']+)',\s*'([^']+)'\)/
                );
                return match ? { id: match[1], name: match[2] } : null;
              })
              .filter(Boolean);

            // Update category list
            const categoryList = document.getElementById("category-list");
            const dsCol = categoryList.querySelector("ds-col");
            if (dsCol) {
              dsCol.innerHTML = categories
                .map(
                  (cat) => `
                <li class="category-item" onclick="loadCategory('${cat.id}', '${cat.name}')">
                  <strong>${cat.name}</strong>
                </li>
              `
                )
                .join("");
            }
          })
          .catch((error) => {
            console.error("Error loading categories:", error);
            const dsCol = document.querySelector("#category-list ds-col");
            if (dsCol) {
              dsCol.innerHTML =
                '<li class="error">Error loading categories</li>';
            }
          });
      }

      function loadCategory(universeId, categoryName, options = {}) {
        const { skipHistory = false, replace = false } = options;
        const encodedCategory = encodeURIComponent(categoryName);

        // Update URL
        if (!skipHistory) {
          updateURL(
            `/universe/${universeId}/category/${encodedCategory}`,
            { view: "category", universeId, categoryName },
            { replace }
          );
        }

        // Load category content
        fetch(
          `http://localhost:3000/universes/${universeId}/category/${encodedCategory}`
        )
          .then((response) => response.text())
          .then((html) => {
            // Update main content with category content
            const mainContent = document.getElementById("main-content");
            mainContent.innerHTML = html;

            // Update sidebar to show items in this category
            updateCategorySidebar(universeId, categoryName);
          })
          .catch((error) => {
            console.error("Error loading category:", error);
            document.getElementById("main-content").innerHTML =
              '<div class="error">Error loading category</div>';
          });
      }

      function updateCategorySidebar(universeId, categoryName) {
        // Update sidebar to show items in the selected category
        const sidebar = document.querySelector("#wiki-sidebar");
        if (!sidebar) {
          console.error("Sidebar element not found");
          return;
        }
        const encodedCategory = encodeURIComponent(categoryName);
        sidebar.innerHTML = `
          <ds-col gap="24px">
            <header>
              <h2>${categoryName}</h2>
              <ds-button variant="secondary" onclick="showUniverse('${universeId}')" class="back-btn">
                ← Back to Universe
              </ds-button>
            </header>
            <nav>
              <ul class="item-list" id="item-list">
                <ds-col gap="24px">
                  <li class="loading">Loading items...</li>
                </ds-col>
              </ul>
            </nav>
            <ds-button variant="primary" onclick="createContent('${categoryName.toLowerCase()}')" class="create-btn">
              Create New ${categoryName.slice(0, -1)}
            </ds-button>
          </ds-col>
        `;

        // Load items for this category
        fetch(
          `http://localhost:3000/universes/${universeId}/category/${encodedCategory}`
        )
          .then((response) => response.text())
          .then((html) => {
            const tempDiv = document.createElement("div");
            tempDiv.innerHTML = html;
            const contentItems = tempDiv.querySelectorAll(".content-item");

            const items = Array.from(contentItems)
              .map((item) => {
                const onclick = item.getAttribute("onclick");
                const match = onclick.match(/loadPage\('([^']+)'\)/);
                return match
                  ? {
                      id: match[1],
                      title: item.querySelector("h3").textContent,
                    }
                  : null;
              })
              .filter(Boolean);

            // Update item list
            const itemList = document.getElementById("item-list");
            const dsCol = itemList.querySelector("ds-col");
            if (dsCol) {
              dsCol.innerHTML = items
                .map(
                  (item) => `
                <li class="item-item" onclick="loadPage('${item.id}')">
                  <strong>${item.title}</strong>
                </li>
              `
                )
                .join("");
            }
          })
          .catch((error) => {
            console.error("Error loading items:", error);
            const dsCol = document.querySelector("#item-list ds-col");
            if (dsCol) {
              dsCol.innerHTML = '<li class="error">Error loading items</li>';
            }
          });
      }

      function loadPage(pageId, options = {}) {
        const { skipHistory = false, replace = false } = options;
        const encodedPageId = encodeURIComponent(pageId);

        // Update URL
        if (!skipHistory) {
          updateURL(
            `/page/${encodedPageId}`,
            { view: "page", pageId },
            {
              replace,
            }
          );
        }

        // Load individual page content
        fetch(`http://localhost:3000/universes/page/${encodedPageId}/fragment`)
          .then((response) => response.text())
          .then((html) => {
            // Update main content with page content
            const mainContent = document.getElementById("main-content");
            mainContent.innerHTML = html;

            // Process markdown links to enable anchor navigation
            processWikiLinks();
          })
          .catch((error) => {
            console.error("Error loading page:", error);
            document.getElementById("main-content").innerHTML =
              '<div class="error">Error loading page</div>';
          });
      }

      function processWikiLinks() {
        // Process markdown links to enable anchor navigation within the page
        const markdownContent = document.querySelector(".markdown-content");
        if (!markdownContent) return;

        // Find all internal links (links that start with #)
        const links = markdownContent.querySelectorAll('a[href^="#"]');
        links.forEach((link) => {
          link.addEventListener("click", function (e) {
            e.preventDefault();
            const targetId = this.getAttribute("href").substring(1);
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
              targetElement.scrollIntoView({ behavior: "smooth" });
            }
          });
        });
      }

      function getCurrentUniverseId() {
        // Try to get universe ID from URL hash
        const hash = window.location.hash;
        if (hash && hash.startsWith("#universe/")) {
          return hash.replace("#universe/", "");
        }

        // Try to get from current page context
        const universeContent = document.getElementById("universe-content");
        if (universeContent && universeContent.dataset.universeId) {
          return universeContent.dataset.universeId;
        }

        // Try to get from active universe item
        const activeUniverse = document.querySelector(".universe-item.active");
        if (activeUniverse && activeUniverse.dataset.universeId) {
          return activeUniverse.dataset.universeId;
        }

        return null;
      }

      function checkJobStatus(jobId) {
        console.log(`Checking status for job: ${jobId}`);

        const loadingIndicator = document.getElementById("loading-indicator");
        if (loadingIndicator) {
          loadingIndicator.style.display = "block";
        }

        fetch(`http://localhost:3000/job/${jobId}/status`)
          .then((response) => {
            if (!response.ok) {
              throw new Error(`Request failed with status ${response.status}`);
            }
            return response.json();
          })
          .then((status) => {
            console.log("Job status:", status);
            if (loadingIndicator) {
              loadingIndicator.style.display = "none";
            }

            const mainContent = document.getElementById("main-content");
            if (mainContent) {
              let statusHtml = `
                <section class="wiki-article job-status">
                  <h2>Job Status</h2>
                  <p><strong>Job ID:</strong> ${status.jobId}</p>
                  <p><strong>Status:</strong> ${status.status}</p>
                  <p><strong>Progress:</strong> ${status.progress || 0}%</p>
              `;

              if (status.status === "completed") {
                statusHtml += `
                  <div class="success-message">
                    <h3>Content Generated Successfully!</h3>
                    <p>Your ${status.data?.type || "content"} has been created and added to the universe.</p>
                    <button class="ds-button ds-button-primary" onclick="refreshUniverseContent()">
                      Refresh Universe
                    </button>
                  </div>
                `;
              } else if (status.status === "failed") {
                statusHtml += `
                  <div class="error-message">
                    <h3>Content Generation Failed</h3>
                    <p>Error: ${status.error || "Unknown error occurred"}</p>
                    <button class="ds-button ds-button-secondary" onclick="createContent('${status.data?.type || "world"}')">
                      Try Again
                    </button>
                  </div>
                `;
              } else {
                statusHtml += `
                  <div class="pending-message">
                    <p>Content is still being generated. This may take a few minutes.</p>
                    <button class="ds-button ds-button-secondary" onclick="checkJobStatus('${jobId}')">
                      Check Again
                    </button>
                  </div>
                `;
              }

              statusHtml += `</section>`;
              mainContent.innerHTML = statusHtml;
            }
          })
          .catch((error) => {
            console.error("Error checking job status:", error);
            if (loadingIndicator) {
              loadingIndicator.style.display = "none";
            }

            const mainContent = document.getElementById("main-content");
            if (mainContent) {
              mainContent.innerHTML = `
                <section class="wiki-article">
                  <div class="wiki-error">
                    Failed to check job status. ${error.message}
                  </div>
                </section>
              `;
            }
          });
      }

      function refreshUniverseContent() {
        const universeId = getCurrentUniverseId();
        if (universeId) {
          showUniverse(universeId);
        } else {
          showUniverseList();
        }
      }

      function createContent(type) {
        console.log(`Creating new ${type}`);

        // Get current universe ID from URL or context
        const currentUniverseId = getCurrentUniverseId();
        if (!currentUniverseId) {
          alert("Please select a universe first");
          return;
        }

        // Show loading indicator
        const loadingIndicator = document.getElementById("loading-indicator");
        if (loadingIndicator) {
          loadingIndicator.style.display = "block";
        }

        // Make API call to create content
        fetch("http://localhost:3000/content/create", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            universeId: currentUniverseId,
            type: type,
          }),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error(`Request failed with status ${response.status}`);
            }
            return response.text(); // Get HTML response
          })
          .then((html) => {
            console.log(`${type} creation queued`);
            if (loadingIndicator) {
              loadingIndicator.style.display = "none";
            }

            // Update main content with queued message
            const mainContent = document.getElementById("main-content");
            if (mainContent) {
              mainContent.innerHTML = html;
            }
          })
          .catch((error) => {
            console.error(`Error creating ${type}:`, error);
            if (loadingIndicator) {
              loadingIndicator.style.display = "none";
            }

            const mainContent = document.getElementById("main-content");
            if (mainContent) {
              mainContent.innerHTML = `
                <section class="wiki-article">
                  <div class="wiki-error">
                    Failed to create ${type}. ${error.message}
                  </div>
                </section>
              `;
            }
          });
      }

      function createNewUniverse(universeName) {
        if (!universeName) {
          showUniverseModal();
          return;
        }

        const trimmedName = universeName.trim();
        if (!trimmedName) {
          alert("Please enter a universe name");
          showUniverseModal();
          return;
        }

        hideUniverseModal();

        const loadingIndicator = document.getElementById("loading-indicator");
        if (loadingIndicator) {
          loadingIndicator.style.display = "block";
        }

        const homepage = document.getElementById("homepage");
        if (homepage) {
          homepage.style.display = "none";
        }

        const universeContent = document.getElementById("universe-content");
        if (universeContent) {
          universeContent.style.display = "none";
          universeContent.classList.remove("active");
        }

        fetch("http://localhost:3000/new", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            name: trimmedName,
            description: "A newly created universe",
          }),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error(`Request failed with status ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            console.log("Universe created:", data);
            if (loadingIndicator) {
              loadingIndicator.style.display = "none";
            }

            const mainContent = document.getElementById("main-content");
            if (mainContent) {
              const universeId = data?.universe?.id || data?.universeId || "";
              const statusBlock = document.createElement("section");
              statusBlock.className = "wiki-article creation-result";
              statusBlock.innerHTML = `
                <h2>Universe Created!</h2>
                <p>${data?.message || "Universe created successfully."}</p>
                <p><strong>Status:</strong> ${data?.status || "created"}</p>
                ${
                  universeId
                    ? `<p><strong>Universe ID:</strong> ${universeId}</p>`
                    : ""
                }
                <div class="creation-actions">
                  ${
                    universeId
                      ? `<ds-button variant="primary" onclick="showUniverse('${universeId}')">
                          Explore Universe
                        </ds-button>`
                      : ""
                  }
                  <ds-button variant="secondary" onclick="showUniverseList()">
                    View All Universes
                  </ds-button>
                </div>
              `;
              mainContent.innerHTML = "";
              mainContent.appendChild(statusBlock);
            }

            loadUniverses();
          })
          .catch((error) => {
            console.error("Error creating universe:", error);
            if (loadingIndicator) {
              loadingIndicator.style.display = "none";
            }

            const mainContent = document.getElementById("main-content");
            if (mainContent) {
              mainContent.innerHTML = `
                <section class="wiki-article">
                  <div class="wiki-error">
                    Failed to create universe. ${error.message}
                  </div>
                </section>
              `;
            }
          });
      }

      function showUniverseModal() {
        const modal = document.getElementById("universe-modal");
        const nameInput = document.getElementById("universe-name");

        modal.classList.add("show");
        // Focus on the name input
        setTimeout(() => {
          nameInput.focus();
        }, 100);
      }

      function hideUniverseModal() {
        const modal = document.getElementById("universe-modal");
        const form = document.getElementById("universe-form");

        modal.classList.remove("show");
        // Reset form
        form.reset();
      }

      function showHelp() {
        // Hide other content
        document.getElementById("homepage").style.display = "none";
        document.getElementById("universe-content").style.display = "none";

        // Show help content
        const mainContent = document.getElementById("main-content");
        mainContent.innerHTML = `
          <div class="wiki-article">
            <h1>Help & Documentation</h1>
            
            <h2>🚀 About Canon</h2>
            <p>Canon is an LLM-driven universe builder that creates rich, interconnected fictional worlds with geography, flora, fauna, intelligent species, cultures, and technologies. The system uses advanced AI to generate coherent, detailed content that builds upon itself to create immersive fictional universes.</p>
            
            <h2>🧭 Navigation Guide</h2>
            <div class="help-navigation">
              <div class="nav-item">
                <h3>🏠 Home</h3>
                <p>Return to the main page with project overview and quick start options.</p>
              </div>
              <div class="nav-item">
                <h3>✨ Create</h3>
                <p>Generate a new universe using AI. Simply provide a name and the system will create a rich, detailed fictional world.</p>
              </div>
              <div class="nav-item">
                <h3>📊 Queue</h3>
                <p>Monitor the current build queue status, including waiting, active, completed, and failed jobs. Features real-time updates with auto-refresh capabilities.</p>
              </div>
              <div class="nav-item">
                <h3>❓ Help</h3>
                <p>This page - comprehensive documentation and resources for using Canon.</p>
              </div>
            </div>

            <h2>🌍 Exploring Universes</h2>
            <p>Once you've created a universe, you can explore its rich content organized into categories:</p>
            <ul>
              <li><strong>🌍 Worlds:</strong> Planets, space stations, and other locations with detailed geography, climate, and resources</li>
              <li><strong>👥 Characters:</strong> Intelligent beings from various species with unique backgrounds, personalities, and relationships</li>
              <li><strong>🏛️ Cultures:</strong> Societies with their own values, government structures, and cultural artifacts</li>
              <li><strong>⚡ Technologies:</strong> Advanced technologies, from FTL drives to alien innovations beyond our understanding</li>
            </ul>

            <h2>🔧 Technical Information</h2>
            <div class="tech-info">
              <div class="tech-section">
                <h3>Architecture</h3>
                <p>Canon uses a modern microservices architecture with:</p>
                <ul>
                  <li><strong>Frontend:</strong> Vanilla JavaScript with Standards-UI components</li>
                  <li><strong>Backend:</strong> NestJS with TypeScript</li>
                  <li><strong>Database:</strong> Neo4j graph database for complex relationships</li>
                  <li><strong>Queue System:</strong> Bull queue with Redis for job management</li>
                  <li><strong>AI Integration:</strong> Langflow for content generation</li>
                </ul>
              </div>
              
              <div class="tech-section">
                <h3>Development</h3>
                <p>The project follows modern development practices:</p>
                <ul>
                  <li>TypeScript for type safety</li>
                  <li>Docker containerization</li>
                  <li>API-first design with Swagger documentation</li>
                  <li>Test-driven development with Vitest</li>
                </ul>
              </div>
            </div>

            <h2>📚 API Documentation</h2>
            <div class="api-links">
              <div class="api-link-card">
                <h3>📖 Interactive API Docs</h3>
                <p>Comprehensive Swagger documentation with interactive testing capabilities.</p>
                <a href="http://localhost:3000/api/docs" target="_blank" class="wiki-btn">
                  Open Swagger UI
                </a>
              </div>
              
              <div class="api-link-card">
                <h3>🔗 API Overview</h3>
                <p>Quick reference for all available endpoints and their purposes.</p>
                <a href="http://localhost:3000/" target="_blank" class="wiki-btn wiki-btn-secondary">
                  View API Overview
                </a>
              </div>
            </div>

            <h2>🚀 Getting Started</h2>
            <div class="getting-started">
              <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                  <h3>Create Your First Universe</h3>
                  <p>Click the "Create" button in the navigation and provide a name for your universe. The AI will generate a rich, detailed world for you to explore.</p>
                </div>
              </div>
              
              <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                  <h3>Explore the Content</h3>
                  <p>Navigate through the generated worlds, characters, cultures, and technologies. Each piece of content is interconnected and builds upon the others.</p>
                </div>
              </div>
              
              <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                  <h3>Monitor Progress</h3>
                  <p>Use the Queue page to monitor content generation progress and see real-time updates as new content is created.</p>
                </div>
              </div>
            </div>

            <h2>🛠️ Troubleshooting</h2>
            <div class="troubleshooting">
              <div class="trouble-item">
                <h3>Content Not Loading</h3>
                <p>If content fails to load, check the Queue page for any failed jobs. You can retry failed content generation from there.</p>
              </div>
              
              <div class="trouble-item">
                <h3>Slow Performance</h3>
                <p>Content generation is AI-powered and may take several minutes. Monitor progress in the Queue page and be patient with complex content.</p>
              </div>
              
              <div class="trouble-item">
                <h3>API Errors</h3>
                <p>If you encounter API errors, check the backend logs and ensure all services are running properly. The Swagger docs can help with debugging API issues.</p>
              </div>
            </div>

            <h2>🔗 Useful Links</h2>
            <div class="useful-links">
              <a href="http://localhost:3000/api/docs" target="_blank" class="link-card">
                <h3>📖 Swagger API Documentation</h3>
                <p>Interactive API documentation with testing capabilities</p>
              </a>
              
              <a href="http://localhost:3000/" target="_blank" class="link-card">
                <h3>🔧 Backend API Overview</h3>
                <p>Quick reference for all available endpoints</p>
              </a>
              
              <a href="http://localhost:3000/queue/stats" target="_blank" class="link-card">
                <h3>📊 Queue Statistics</h3>
                <p>Direct access to queue status and statistics</p>
              </a>
            </div>

            <div class="help-footer">
              <p><strong>Need more help?</strong> Check the API documentation or examine the source code for detailed implementation information.</p>
            </div>
          </div>
        `;
      }

      // Queue management variables
      let queuePollingInterval = null;
      let queueDebounceTimeout = null;

      function showQueue(options = {}) {
        const { skipHistory = false, replace = false } = options;

        // Update URL
        if (!skipHistory) {
          updateURL("/queue", { view: "queue" }, { replace });
        }

        // Hide other content
        document.getElementById("homepage").style.display = "none";
        document.getElementById("universe-content").style.display = "none";

        // Show queue content
        const mainContent = document.getElementById("main-content");
        mainContent.innerHTML = `
          <div class="wiki-article">
            <h1>Build Queue</h1>
            <p>Monitor the current status of content generation jobs.</p>
            
            <div id="queue-stats" class="queue-stats">
              <div class="wiki-loading">Loading queue status...</div>
            </div>
            
            <div id="queue-jobs" class="queue-jobs">
              <!-- Job details will be loaded here -->
            </div>
            
            <div class="queue-controls">
              <button class="wiki-btn" onclick="refreshQueueData()">Refresh</button>
              <button class="wiki-btn wiki-btn-secondary" onclick="toggleQueuePolling()" id="polling-toggle">
                Start Auto-Refresh
              </button>
            </div>
          </div>
        `;

        // Load initial queue data
        loadQueueData();
      }

      function loadQueueData() {
        fetch("http://localhost:3000/queue/stats")
          .then((response) => response.json())
          .then((stats) => {
            updateQueueDisplay(stats);
          })
          .catch((error) => {
            console.error("Error loading queue data:", error);
            document.getElementById("queue-stats").innerHTML = `
              <div class="wiki-error">Error loading queue status: ${error.message}</div>
            `;
          });
      }

      function updateQueueDisplay(stats) {
        const queueStatsElement = document.getElementById("queue-stats");
        if (!queueStatsElement) return;

        const totalJobs = stats.total || 0;
        const waitingJobs = stats.waiting || 0;
        const activeJobs = stats.active || 0;
        const completedJobs = stats.completed || 0;
        const failedJobs = stats.failed || 0;

        queueStatsElement.innerHTML = `
          <div class="queue-summary">
            <h2>Queue Summary</h2>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-number">${totalJobs}</div>
                <div class="stat-label">Total Jobs</div>
              </div>
              <div class="stat-card waiting">
                <div class="stat-number">${waitingJobs}</div>
                <div class="stat-label">Waiting</div>
              </div>
              <div class="stat-card active">
                <div class="stat-number">${activeJobs}</div>
                <div class="stat-label">Active</div>
              </div>
              <div class="stat-card completed">
                <div class="stat-number">${completedJobs}</div>
                <div class="stat-label">Completed</div>
              </div>
              <div class="stat-card failed">
                <div class="stat-number">${failedJobs}</div>
                <div class="stat-label">Failed</div>
              </div>
            </div>
          </div>
        `;

        // Update polling toggle button text
        const pollingToggle = document.getElementById("polling-toggle");
        if (pollingToggle) {
          pollingToggle.textContent = queuePollingInterval
            ? "Stop Auto-Refresh"
            : "Start Auto-Refresh";
        }
      }

      function refreshQueueData() {
        // Clear any existing debounce timeout
        if (queueDebounceTimeout) {
          clearTimeout(queueDebounceTimeout);
        }

        // Debounce the refresh to prevent too frequent requests
        queueDebounceTimeout = setTimeout(() => {
          loadQueueData();
        }, 1000);
      }

      function toggleQueuePolling() {
        if (queuePollingInterval) {
          // Stop polling
          clearInterval(queuePollingInterval);
          queuePollingInterval = null;
          console.log("Queue polling stopped");
        } else {
          // Start polling
          queuePollingInterval = setInterval(() => {
            refreshQueueData();
          }, 2000); // Poll every 2 seconds
          console.log("Queue polling started");
        }

        // Update button text
        const pollingToggle = document.getElementById("polling-toggle");
        if (pollingToggle) {
          pollingToggle.textContent = queuePollingInterval
            ? "Stop Auto-Refresh"
            : "Start Auto-Refresh";
        }
      }

      // Clean up polling when leaving queue page
      function stopQueuePolling() {
        if (queuePollingInterval) {
          clearInterval(queuePollingInterval);
          queuePollingInterval = null;
        }
        if (queueDebounceTimeout) {
          clearTimeout(queueDebounceTimeout);
          queueDebounceTimeout = null;
        }
      }

      function showUniverseList(options = {}) {
        const { skipHistory = false, replace = false } = options;

        // Stop queue polling when navigating away
        stopQueuePolling();

        // Update URL
        if (!skipHistory) {
          updateURL("/universes", { view: "universe-list" }, { replace });
        }

        // Clear main content and show universe list
        const mainContent = document.getElementById("main-content");
        if (mainContent) {
          mainContent.innerHTML = `
            <div class="wiki-article">
              <h1>All Universes</h1>
              <div class="wiki-content-list">
                <div id="universe-list-container">
                  <div class="wiki-loading">Loading universes...</div>
                </div>
              </div>
            </div>
          `;
        }

        // Load universes into the main content
        loadUniversesForList();
      }

      function loadUniversesForList() {
        fetch("http://localhost:3000/universes")
          .then((response) => response.text())
          .then((html) => {
            // Wrap the content in a proper container
            document.getElementById("universe-list-container").innerHTML = html;

            // Event listeners are handled by document-level click handler
            console.log(
              "Universe list loaded, event handling via document listener"
            );
          })
          .catch((error) => {
            console.error("Error loading universes:", error);
            document.getElementById("universe-list-container").innerHTML =
              '<div class="wiki-error">Error loading universes</div>';
          });
      }

      function showHomepage(options = {}) {
        const { skipHistory = false, replace = false } = options;

        // Stop queue polling when navigating away
        stopQueuePolling();

        // Update URL
        if (!skipHistory) {
          updateURL("/", { view: "home" }, { replace });
        }

        // Clear main content and show homepage
        const mainContent = document.getElementById("main-content");
        if (mainContent) {
          mainContent.innerHTML = `
            <!-- Homepage -->
            <section id="homepage" class="wiki-homepage">
              <h1>Canon</h1>
              <p class="subtitle">
                An LLM-driven universe builder that creates rich, interconnected
                fictional worlds with geography, flora, fauna, intelligent
                species, cultures, and technologies.
              </p>

              <a href="#" class="wiki-btn" onclick="createNewUniverse()">
                Create Your First Universe
              </a>

              <div class="wiki-cards">
                <div class="wiki-card">
                  <h3>🌍 Worlds</h3>
                  <p>
                    Explore planets, space stations, and other locations with
                    detailed geography, climate, and resources.
                  </p>
                </div>
                <div class="wiki-card">
                  <h3>👥 Characters</h3>
                  <p>
                    Meet intelligent beings from various species with unique
                    backgrounds, personalities, and relationships.
                  </p>
                </div>
                <div class="wiki-card">
                  <h3>🏛️ Cultures</h3>
                  <p>
                    Discover societies with their own values, government structures,
                    and cultural artifacts.
                  </p>
                </div>
                <div class="wiki-card">
                  <h3>⚡ Technologies</h3>
                  <p>
                    Learn about advanced technologies, from FTL drives to alien
                    innovations beyond our understanding.
                  </p>
                </div>
              </div>
            </section>

            <!-- Loading Indicator -->
            <div id="loading-indicator" class="wiki-loading" style="display: none">
              <p>Creating universe...</p>
            </div>
          `;
        }

        // Reset sidebar to show universes
        const sidebar = document.querySelector("#wiki-sidebar");
        if (!sidebar) {
          console.error("Sidebar element not found");
          return;
        }
        sidebar.innerHTML = `
          <ds-col gap="24px">
            <header>
              <h2>Universes</h2>
            </header>
            <nav>
              <ul class="universe-list" id="universe-list">
                <ds-col gap="24px">
                  <li class="loading">Loading universes...</li>
                </ds-col>
              </ul>
            </nav>
            <ds-button
              variant="primary"
              class="create-universe-btn"
              onclick="createNewUniverse()">
              Create New Universe
            </ds-button>
          </ds-col>
        `;

        // Reload universes
        loadUniverses();
      }

      // Handle universe selection - simplified approach
      document.addEventListener("click", function (e) {
        console.log("Document click detected on:", e.target);

        if (
          e.target.classList.contains("universe-item") ||
          e.target.closest(".universe-item")
        ) {
          e.preventDefault();
          e.stopPropagation();

          const universeItem = e.target.classList.contains("universe-item")
            ? e.target
            : e.target.closest(".universe-item");
          const universeId = universeItem.dataset.universeId;

          console.log("Document click handler - universe clicked:", universeId);
          console.log("Universe item element:", universeItem);

          if (universeId) {
            showUniverse(universeId);

            // Update active state
            document.querySelectorAll(".universe-item").forEach((item) => {
              item.classList.remove("active");
            });
            universeItem.classList.add("active");
          } else {
            console.error("No universe ID found on clicked element");
          }
        }
      });

      // Handle back to homepage
      document.addEventListener("click", function (e) {
        console.log(
          "Click detected on:",
          e.target,
          "Classes:",
          e.target.classList
        );
        if (
          e.target.classList.contains("back-to-home") ||
          e.target.closest(".back-to-home")
        ) {
          console.log("Back to home button clicked!");
          e.preventDefault();
          e.stopPropagation();

          // Direct navigation without URL update first
          navigateToHome();
        }
      });

      function navigateToHome() {
        showHomepage();
      }
    </script>
  </body>
</html>
